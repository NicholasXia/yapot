
<!DOCTYPE html>
<!-- 
Template Name: Metronic - Responsive Admin Dashboard Template build with Twitter Bootstrap 3.0
Version: 1.5.3
Author: KeenThemes
Website: http://www.keenthemes.com/
Purchase: http://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469?ref=keenthemes
-->
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
	<meta charset="utf-8" />
	<title>欢迎进入微信首次设置</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta content="width=device-width, initial-scale=1.0" name="viewport" />
	<meta content="" name="description" />
	<meta content="" name="author" />
	<meta name="MobileOptimized" content="320">
	<!-- BEGIN GLOBAL MANDATORY STYLES -->        
	<link href="/assets/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
	<link href="/assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
	<link href="/assets/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css"/>
	<!-- END GLOBAL MANDATORY STYLES -->
	<!-- BEGIN THEME STYLES --> 
	<link href="/assets/css/style-metronic.css" rel="stylesheet" type="text/css"/>
	<link href="/assets/css/style.css" rel="stylesheet" type="text/css"/>
	<link href="/assets/css/style-responsive.css" rel="stylesheet" type="text/css"/>
	<link href="/assets/css/plugins.css" rel="stylesheet" type="text/css"/>
	<link href="/assets/css/themes/default.css" rel="stylesheet" type="text/css" id="style_color"/>
	<link href="/assets/css/custom.css" rel="stylesheet" type="text/css"/>
	<link rel="stylesheet" type="text/css" href="/assets/plugins/bootstrap-fileupload/bootstrap-fileupload.css" />
	<link rel="stylesheet" type="text/css" href="/assets/plugins/bootstrap-markdown/css/bootstrap-markdown.min.css">
	<link rel="stylesheet" type="text/css" href="/assets/plugins/bootstrap-wysihtml5/bootstrap-wysihtml5.css" />
	<script type="text/javascript" src="/assets/plugins/ueditor/ueditor.config.js"></script>
	<script type="text/javascript" src="/assets/plugins/ueditor/ueditor.all.min.js"></script>
	<!-- END THEME STYLES -->
	<link rel="shortcut icon" href="favicon.ico" />
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->
<body class="page-header-fixed page-full-width">
	<!-- BEGIN HEADER -->   
	<div class="header navbar navbar-inverse navbar-fixed-top">
		<% include ../include/top %>
	</div>
	<!-- END HEADER -->
	<div class="clearfix"></div>
	<!-- BEGIN CONTAINER -->   
	<div class="page-container">
		<div class="page-content">
			<div class="row">
				<div class="col-md-12">
					<div class="portlet box blue" id="form_wizard_1">
						<div class="portlet-title">
							<div class="caption">
								<i class="fa fa-reorder"></i>开通微信功能 <span class="step-title"></span>
							</div>
							<div class="tools hidden-xs">
								<a href="javascript:;" class="collapse"></a>
								<a href="#portlet-config" data-toggle="modal" class="config"></a>
								<a href="javascript:;" class="reload"></a>
								<a href="javascript:;" class="remove"></a>
							</div>
						</div>
						<div class="portlet-body form">
							<form action="#" class="form-horizontal" id="submit_form" novalidate="novalidate">
								<div class="form-wizard">
									<div class="form-body">
										<ul class="nav nav-pills nav-justified steps">
											<li class="active">
												<a href="#tab1" data-toggle="tab" class="step">
												<span class="number">1</span>
												<span class="desc"><i class="fa fa-check"></i> 微信基本资料</span>   
												</a>
											</li>
											<li>
												<a href="#tab2" data-toggle="tab" class="step">
												<span class="number">2</span>
												<span class="desc"><i class="fa fa-check"></i> 微信类型</span>   
												</a>
											</li>
											<li>
												<a href="#tab3" data-toggle="tab" class="step active">
												<span class="number">3</span>
												<span class="desc"><i class="fa fa-check"></i> 完成配置</span>   
												</a>
											</li>
											
											
										</ul>
										<div id="bar" class="progress progress-striped" role="progressbar">
											<div id="idWizardProgress" class="progress-bar progress-bar-success" style="width: 25%;"></div>
										</div>
										<div class="tab-content">
											<div class="alert alert-danger display-none">
												<button class="close" data-dismiss="alert"></button>
												信息填写不完整，相关信息请去微信公众平台，请点击<a href='https://mp.weixin.qq.com/' target='_blank'>账号信息</a>中进行查看。
											</div>
											<div class="alert alert-success display-none">
												<button class="close" data-dismiss="alert"></button>
												提交成功
											</div>
											<div class="tab-pane active" id="tab1">
												<h3 class="block">微信基本信息</h3>
												<div class="form-group">
													<label class="control-label col-md-3">名称<span class="required">*</span></label>
													<div class="col-md-4">
														<input type="text" class="form-control" name="name">
														
													</div>
												</div>
												<div class="form-group">
													<label class="control-label col-md-3">原始ID<span class="required">*</span></label>
													<div class="col-md-4">
														<input type="text" class="form-control" name="wxid" >
														
													</div>
												</div>
												<div class="form-group">
													<label class="control-label col-md-3">微信号<span class="required">*</span></label>
													<div class="col-md-4">
														<input type="text" class="form-control" name="wxhao" >
														
													</div>
												</div>
												
											</div>
											<div class="tab-pane" id="tab2">
												<h3 class="block">填写微信账号类型</h3>
												<div class="form-group">
													<label class="control-label col-md-3">微信账号类型<span class="required">*</span></label>
													<div class="col-md-9">
																<div class="radio-list">
																	<label class="radio-inline">
																	<input type="radio" data-title="订阅号" name="type" value="1" checked/>
																	订阅号 </label>
																	<label class="radio-inline">
																	<input type="radio" data-title="服务号" name="type" value="2" />
																	服务号 </label>
																</div>
															</div>

												</div>
												
											</div>
										
											<div class="tab-pane" id="tab3">
												<h3 class="block">微信账号信息确认</h3>
												<h4 class="form-section">基本资料</h4>
												<div class="form-group">
													<label class="control-label col-md-3">名称：</label>
													<div class="col-md-4">
														<p class="form-control-static" data-display="name"></p>
													</div>
												</div>
												<div class="form-group">
													<label class="control-label col-md-3">原始ID：</label>
													<div class="col-md-4">
														<p class="form-control-static" data-display="wxid"></p>
													</div>
												</div>
												<div class="form-group">
													<label class="control-label col-md-3">微信号：</label>
													<div class="col-md-4">
														<p class="form-control-static" data-display="wxhao"></p>
													</div>
												</div>
												<h4 class="form-section">微信账号类型</h4>
												<div class="form-group">
													<label class="control-label col-md-3">类型：</label>
													<div class="col-md-4">
														<p class="form-control-static" data-display="type"></p>
													</div>
												</div>
												

												
												
											
											</div>
											
										</div>
										</div>
									</div>
									<div class="form-actions fluid">
										<div class="row">
											<div class="col-md-12">
												<div class="col-md-offset-3 col-md-9">
													<a href="javascript:;" class="btn default button-previous disabled" style="display: none;">
													<i class="m-icon-swapleft"></i> 返回上一步
													</a>
													<a href="javascript:;" class="btn blue button-next">
													下一步 <i class="m-icon-swapright m-icon-white"></i>
													</a>
													<a href="javascript:;" class="btn green button-submit" style="display: none;">
													提交 <i class="m-icon-swapright m-icon-white"></i>
													</a>                            
												</div>
											</div>
										</div>
									</div>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- END CONTAINER -->
	<!-- BEGIN FOOTER -->
	<%include ../include/footer.ejs %>
	<!-- END FOOTER -->
	<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
	<!-- BEGIN CORE PLUGINS -->   
	<%include ../include/ie.ejs %>
	<%include ../include/core_plugin.ejs %>
	<!-- END CORE PLUGINS -->
	<script type="text/javascript" src="/assets/plugins/jquery-validation/dist/jquery.validate.min.js"></script>
	<script type="text/javascript" src="/assets/plugins/jquery-validation/dist/additional-methods.min.js"></script>
	<script type="text/javascript" src="/assets/plugins/bootstrap-wizard/jquery.bootstrap.wizard.min.js"></script>

	<script type="text/javascript" src="/assets/plugins/bootstrap-wysihtml5/wysihtml5-0.3.0.js"></script> 
	<script type="text/javascript" src="/assets/plugins/bootstrap-wysihtml5/bootstrap-wysihtml5.js"></script>
	<script type="text/javascript" src="/assets/plugins/jquery-file-upload/js/vendor/jquery.ui.widget.js"></script>
	<script type="text/javascript" src="/assets/plugins/jquery-file-upload/js/jquery.iframe-transport.js"></script>
	<script type="text/javascript" src="/assets/plugins/jquery-file-upload/js/jquery.fileupload.js"></script>
	<script src="/assets/scripts/app.js"></script>      
	<script>
		jQuery(document).ready(function() {    
		   App.init();
		   var handleTitle = function(tab, navigation, index) {
                var total = navigation.find('li').length;
                var current = index + 1;
                // set wizard title
                $('.step-title', $('#form_wizard_1')).text('Step ' + (index + 1) + ' of ' + total);
                // set done steps
                jQuery('li', $('#form_wizard_1')).removeClass("done");
                var li_list = navigation.find('li');
                for (var i = 0; i < index; i++) {
                    jQuery(li_list[i]).addClass("done");
                }

                if (current == 1) {
                    $('#form_wizard_1').find('.button-previous').hide();
                } else {
                    $('#form_wizard_1').find('.button-previous').show();
                }

                if (current >= total) {
                    $('#form_wizard_1').find('.button-next').hide();
                    $('#form_wizard_1').find('.button-submit').show();
                    displayConfirm();
                } else {
                    $('#form_wizard_1').find('.button-next').show();
                    $('#form_wizard_1').find('.button-submit').hide();
                }
                App.scrollTo($('.page-title'));
            }

            var displayConfirm = function() {
                $('#tab3 .form-control-static', form).each(function(){

                    var input = $('[name="'+$(this).attr("data-display")+'"]', form);
                    if (input.is(":text") || input.is("textarea")) {
                        $(this).html(input.val());
                    } else if (input.is("select")) {
                        $(this).html(input.find('option:selected').text());
                    } else if (input.is(":radio") && input.is(":checked")) {
                        $(this).html(input.attr("data-title"));
                    } else if ($(this).attr("data-display") == 'payment') {
                        var payment = [];
                        $('[name="payment[]"]').each(function(){
                            payment.push($(this).attr('data-title'));
                        });
                        $(this).html(payment.join("<br>"));
                    }
                });

                $("#idFinalImg").attr("src", $("#idImage").attr("src"));
            }

		   var form = $('#submit_form');
           var error = $('.alert-danger', form);
           var success = $('.alert-success', form);

           form.validate({
                doNotHideMessage: true, //this option enables to show the error/success messages on tab switch.
                errorElement: 'span', //default input error message container
                errorClass: 'help-block', // default input error message class
                focusInvalid: false, // do not focus the last invalid input
                rules: {
                    name: {
                        required: true
                    },
                    wxid: {
                        required: true
                    },
                    wxhao: {
                        required: true
                    },
                    type: {
                        required: true
                    }
                 
                },

                messages: { 
                    'name': {
                        required: "请填写微信公众账号名称"
                    },
                    'wxid': {
                        required: "填写微信原始ID"
                    },
                    'wxhao': {
                        required: "填写微信号"
                    }

                },

                errorPlacement: function (error, element) { // render error placement for each input type
                    if (element.attr("name") == "gender") { // for uniform radio buttons, insert the after the given container
                        error.insertAfter("#form_gender_error");
                    } else if (element.attr("name") == "payment[]") { // for uniform radio buttons, insert the after the given container
                        error.insertAfter("#form_payment_error");
                    } else {
                        error.insertAfter(element); // for other inputs, just perform default behavior
                    }
                },

                invalidHandler: function (event, validator) { //display error alert on form submit   
                    success.hide();
                    error.show();
                    App.scrollTo(error, -200);
                },

                highlight: function (element) { // hightlight error inputs
                    $(element)
                        .closest('.form-group').removeClass('has-success').addClass('has-error'); // set error class to the control group
                },

                unhighlight: function (element) { // revert the change done by hightlight
                    $(element)
                        .closest('.form-group').removeClass('has-error'); // set error class to the control group
                },

                success: function (label) {
                   
                },

                submitHandler: function (form) {
                    success.show();
                    error.hide();
                    //add here some ajax code to submit your form or just call form.submit() if you want to submit the form without ajax
                    
                }

            });


		   $('#form_wizard_1').bootstrapWizard({
                'nextSelector': '.button-next',
                'previousSelector': '.button-previous',
                onTabClick: function (tab, navigation, index, clickedIndex) {
                    success.hide();
                    error.hide();
                    if (form.valid() == false) {
                        return false;
                    }
                    handleTitle(tab, navigation, clickedIndex);
                },
                onNext: function (tab, navigation, index) {
                    success.hide();
                    error.hide();

                    if (form.valid() == false) {
                        return false;
                    }

                    handleTitle(tab, navigation, index);
                },
                onPrevious: function (tab, navigation, index) {
                    success.hide();
                    error.hide();

                    handleTitle(tab, navigation, index);
                },
                onTabShow: function (tab, navigation, index) {
                    var total = navigation.find('li').length;
                    var current = index + 1;
                    var $percent = (current / total) * 100;
                    $('#form_wizard_1').find('#idWizardProgress').css({
                        width: $percent + '%'
                    });
                }
            });

            $('#form_wizard_1').find('.button-previous').hide();
            $('#form_wizard_1 .button-submit').click(function () {
                    // $.getJSON('/cms/ajSaveInit',form.serialize(),function(data){
                    // 	window.location = location;
                    // });
                    $.ajax({
		                type: "POST",
		                url: "/wx/ajSaveInit",
		                data: form.serialize(),
		                dataType: "json",
		                beforeSend:function(){
		                    
		                },
		                error: function(jqXHR, textStatus, errorThrown){
		                	cb({'error':1});
		                },
		                success: function(data){
		                	window.location = location;
		                    cb(null);
		                }
		            });
            }).hide();

		});
	</script>

</html>